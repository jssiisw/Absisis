name: Linux-Tailscale-RDP

on: workflow_dispatch

jobs:
  build:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout Repository
        uses: actions/checkout@v3

      - name: Install Desktop Environment and XRDP
        run: |
          sudo apt update
          sudo apt install -y xfce4 xfce4-goodies xrdp
          echo "xfce4-session" > ~/.xsession
          sudo systemctl restart xrdp

      - name: Configure User Account
        run: |
          echo "runneradmin:P@ssw0rd123" | sudo chpasswd
          sudo adduser runneradmin ssl-cert

      - name: Deploy Tailscale
        uses: tailscale/github-action@v2
        with:
          authkey: ${{ secrets.TAILSCALE_AUTHKEY }}

      - name: Fetch Instance IP and Keep Alive
        run: |
          echo "--- Connection Established ---"
          echo "Instance Internal IP:"
          tailscale ip -4
          echo "Username: runneradmin"
          echo "Password: P@ssw0rd123"
          sleep 21600
