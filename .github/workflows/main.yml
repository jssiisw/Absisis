name: Linux-Tailscale-RDP

on: workflow_dispatch

jobs:
  build:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout Repository
        uses: actions/checkout@v4

      - name: Install Desktop and XRDP
        run: |
          sudo apt-get update
          sudo apt-get install -y xfce4 xfce4-goodies xrdp dbus-x11
          sudo systemctl restart xrdp

      - name: Create and Configure User aban
        run: |
          # Create user aban if not exists
          sudo useradd -m -s /bin/bash aban || true
          echo "aban:abanawad100" | sudo chpasswd
          sudo usermod -aG sudo aban
          
          # CRITICAL FIX: Configure the desktop session for user 'aban' specifically
          sudo -u aban bash -c 'echo "exec startxfce4" > ~/.xsession'
          sudo -u aban bash -c 'chmod +x ~/.xsession'

      - name: Deploy Tailscale
        uses: tailscale/github-action@v2
        with:
          authkey: ${{ secrets.TAILSCALE_AUTHKEY }}

      - name: Connection Details
        run: |
          echo "--- SERVER READY ---"
          tailscale ip -4
          echo "User: aban | Pass: abanawad100"
          sleep 21600
