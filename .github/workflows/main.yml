name: Linux-Tailscale-RDP

on: workflow_dispatch

jobs:
  build:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout Repository
        uses: actions/checkout@v4

      - name: Install Desktop Environment (Improved)
        run: |
          sudo apt-get update
          # Installing full xfce4 to avoid session errors
          sudo apt-get install -y xfce4 xfce4-goodies xrdp dbus-x11
          # Fixing the session loading issue
          printf "xfce4-session\n" > ~/.xsession
          sudo systemctl restart xrdp

      - name: Create User aban
        run: |
          sudo useradd -m -s /bin/bash aban
          echo "aban:abanawad100" | sudo chpasswd
          sudo usermod -aG sudo aban

      - name: Deploy Tailscale
        uses: tailscale/github-action@v2
        with:
          # Make sure your Secret name is exactly: TAILSCALE_AUTHKEY
          authkey: ${{ secrets.TAILSCALE_AUTHKEY }}

      - name: Connection Details
        run: |
          echo "--- SERVER READY ---"
          tailscale ip -4
          echo "User: aban | Pass: abanawad100"
          sleep 21600
