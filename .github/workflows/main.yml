name: Linux-Tailscale-RDP

on: workflow_dispatch

jobs:
  build:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout Repository
        uses: actions/checkout@v3

      - name: Install Desktop Environment and XRDP
        run: |
          sudo apt update
          sudo apt install -y xfce4 xfce4-goodies xrdp
          echo "xfce4-session" > ~/.xsession
          sudo systemctl restart xrdp

      - name: Create User and Configure Password
        run: |
          # Create user 'aban' and set password 'abanawad100'
          sudo useradd -m aban
          echo "aban:abanawad100" | sudo chpasswd
          sudo usermod -aG sudo aban
          sudo adduser aban ssl-cert

      - name: Deploy Tailscale
        uses: tailscale/github-action@v2
        with:
          authkey: ${{ secrets.TAILSCALE_AUTHKEY }}

      - name: Fetch Instance IP and Keep Alive
        run: |
          echo "--- Connection Established ---"
          echo "Instance Internal IP:"
          tailscale ip -4
          echo "Username: aban"
          echo "Password: abanawad100"
          sleep 21600
