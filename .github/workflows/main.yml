name: Ubuntu + Tailscale + RDP + User aban

on: [workflow_dispatch]

jobs:
  setup-tailscale-rdp:
    runs-on: ubuntu-latest
    timeout-minutes: 360
    
    steps:
      - name: Install Tailscale
        run: |
          curl -fsSL https://tailscale.com/install.sh | sh
          sudo tailscale up --authkey ${{ secrets.TAILSCALE_AUTH_KEY }} --accept-routes --ssh
          echo "‚úÖ Tailscale connected"

      - name: Get Tailscale IP
        run: |
          echo ""
          echo "=========================================="
          echo "üåê TAILSCALE CONNECTION INFO"
          echo "=========================================="
          echo "Tailscale IPv4: $(tailscale ip -4)"
          echo "Tailscale IPv6: $(tailscale ip -6)"
          echo ""
          echo "üñ•Ô∏è  RDP CONNECTION:"
          echo "IP: $(tailscale ip -4)"
          echo "Port: 3389"
          echo "Username: aban"
          echo "Password: aban"
          echo "=========================================="

      - name: Install Desktop & XRDP
        run: |
          sudo apt-get update -y
          sudo DEBIAN_FRONTEND=noninteractive apt-get install -y xfce4 xfce4-goodies xrdp
          sudo systemctl enable xrdp
          sudo systemctl start xrdp

      - name: Create User 'aban'
        run: |
          sudo useradd -m -s /bin/bash aban
          echo "aban:aban" | sudo chpasswd
          sudo usermod -aG sudo aban
          sudo usermod -aG ssl-cert aban
          
          # ÿ•ÿπÿØÿßÿØ XFCE ŸÑŸÑŸÖÿ≥ÿ™ÿÆÿØŸÖ
          echo "xfce4-session" | sudo tee /home/aban/.xsession
          sudo chown aban:aban /home/aban/.xsession
          
          # ÿ•ÿπÿØÿßÿØ XRDP
          sudo sed -i 's/port=vsock/port=ask/g' /etc/xrdp/xrdp.ini
          sudo systemctl restart xrdp
          
          echo "‚úÖ User 'aban' ready"

      - name: Install CyberSec Tools
        run: |
          sudo apt-get install -y nmap sqlmap nikto dirb gobuster
          sudo apt-get install -y john hashcat hydra
          sudo apt-get install -y netcat-traditional tcpdump tshark
          sudo apt-get install -y binwalk steghide exiftool

      - name: Show Final Info
        run: |
          echo ""
          echo "=========================================="
          echo "‚úÖ READY TO CONNECT"
          echo "=========================================="
          echo "Tailscale IP: $(tailscale ip -4)"
          echo "RDP: $(tailscale ip -4):3389"
          echo "User: aban"
          echo "Pass: aban"
          echo ""
          echo "üì± Connect from any Tailscale device"
          echo "=========================================="
          tailscale status

      - name: Keep Alive
        run: |
          echo "üü¢ Running... Press Cancel to stop"
          sleep 21600
